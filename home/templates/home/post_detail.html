{% extends 'base.html' %}
{% load cloudinary %}

{% block title %} {{ post.title }} {% endblock %}

{% block content %}
<!-- Post details section -->
<div class="container">
    <div class="row">
        <div class="col">
            {% if user.is_authenticated %}
            {% if user.id == post.user.id %}
            <a href="{% url 'post_edit' post.pk %}">Edit</a>
            <a href="{% url 'post_delete' post.pk %}">Delete</a>
            {% endif %}
            {% endif %}
            <h1>Post Details...</h1><br>
            <h3>By: {{ post.user }} - {{ post.created }}</h3>
            <h3>Title: {{ post.title }}</h3>
            <h4>Description: {{ post.description }}</h4>
            <h3>Case: {{ post.case }}</h3>
            <h3>Switches: {{ post.switches }}</h3>
            <h3>Keycaps: {{ post.keycaps }}</h3>
        </div>
        <div class="col">
            <img src="{{ post.image.url }}">
        </div>
    </div>
</div>
<hr>
<!-- Like section -->
<p>Total <i class="fa-solid fa-heart"></i>: {{ total_likes }}</p>
<form action="{% url 'post_like' post.pk %}" method="POST">
    {% csrf_token %}
    {% if user.is_authenticated %}
    {% if liked %}
    <button type="submit" name="post_like_btn" value="{{ post.id }}" class="btn btn-danger"><i
            class="fa-solid fa-heart"></i> Unlike</button>
    {% else %}
    <button type="submit" name="post_like_btn" value="{{ post.id }}" class="btn btn-success"><i
            class="fa-regular fa-heart"></i> Like</button>
    {% endif %}
    {% else %}
    <p>You must register or login to like posts...</p>
    {% endif %}
</form>
<br />
<div>
    <h3>Comments...</h3>
    <hr>
    <div class="card-body">
        {% if not post.comments.all %}
        <p>No comments on this post...</p>
        {% else %}
        {% for comment in post.comments.all %}
        <div class="container">
        <div class="row">
            <div class="col">
                {% if comment.user_profile.image %}
                    <img src="{{ comment.user_profile.image.url }}" width="100" height="100" class="rounded-circle">
                {% else %}
                    <img src="/static/media/user-default.png" alt="Default Profile Image">
                </div>
                {% endif %}
            </div>
            <div class="col">
                <h5>By: {{ comment.user_profile }} - {{ comment.created_on }}
                <div class="col-6">{{ comment.body }}</div>
            </div>
            <hr>
            {% endfor%}
            {% endif %}
        </div>
    </div>
</div>
{% if user.is_authenticated %}
<div class="card-body">
    <div class="form-group">
        <form method="POST">
            {% csrf_token %}
            {{ comment_form.as_p }}
            <button class="btn btn-dark">Add comment...</button>
        </form>
    </div>
</div>
{% endif %}


</br>
<a href="{% url 'posts' %}" class="btn btn-dark">Back</a>

{% endblock %}